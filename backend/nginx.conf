# upstream backend_servers {
#     # IP hash for sticky sessions - ensures same client always goes to same server
#     # This is critical for Socket.IO to work properly with load balancing
#     # ip_hash;
    
#     server backend-1:5001 max_fails=3 fail_timeout=30s;
#     server backend-2:5002 max_fails=3 fail_timeout=30s;
#     server backend-3:5003 max_fails=3 fail_timeout=30s;
# }

# server {
#     listen 80;
#     server_name localhost;

#     # Increase buffer sizes for large headers
#     client_max_body_size 100M;
#     client_body_buffer_size 128k;
#     large_client_header_buffers 4 32k;

#     # Logging
#     access_log /var/log/nginx/access.log;
#     error_log /var/log/nginx/error.log;

#     # Health check endpoint
#     location /health {
#         access_log off;
#         proxy_pass http://backend_servers/health;
#         proxy_http_version 1.1;
#         proxy_set_header Connection "";
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#     }

#     # WebSocket support for Socket.IO
#     location /socket.io/ {
#         proxy_pass http://backend_servers;
#         proxy_http_version 1.1;
#         proxy_set_header Upgrade $http_upgrade;
#         proxy_set_header Connection "upgrade";
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
        
#         # WebSocket timeouts
#         proxy_connect_timeout 7d;
#         proxy_send_timeout 7d;
#         proxy_read_timeout 7d;
#     }

#     # API endpoints
#     location /api/ {
#         proxy_pass http://backend_servers/api/;
#         proxy_http_version 1.1;
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
        
#         # Add backend server info to response headers for debugging
#         add_header X-Upstream-Server $upstream_addr always;
#         add_header X-Load-Balancer "nginx" always;
        
#         # Timeouts
#         proxy_connect_timeout 60s;
#         proxy_send_timeout 60s;
#         proxy_read_timeout 60s;
#     }

#     # Default location - return 404 for anything else
#     location / {
#         return 404 "Not Found - Frontend should run on port 3000";
#     }
# }
